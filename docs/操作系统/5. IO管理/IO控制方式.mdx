---
sidebar_position: 2
---

## 总线补充知识
### 单总线
![](https://skywalkerch-1303839378.cos.ap-nanjing.myqcloud.com/mypicbed202307110935188.svg)
### 双总线
![](https://skywalkerch-1303839378.cos.ap-nanjing.myqcloud.com/mypicbed202307110935141.svg)
### 三总线
![](https://skywalkerch-1303839378.cos.ap-nanjing.myqcloud.com/mypicbed202307111236999.svg)
## IO控制方式
### 程序直接控制方式
:::note
计算机从外部读取每个字，CPU都需要不停的对外设的状态进行循环检查，直到确定该字已经处于IO控制器的数据寄存器中。
#### 缺点
- CPU绝大部分时间处于等待IO设备完成数据IO的循环检测当中，造成CPU资源的极大浪费
- IO设备无法向CPU报告它已经完成了一次IO操作，没有中断机制。
- CPU和IO设备只能串行工作，CPU利用率相当低。
- 一次传输一个字
:::

### 中断驱动方式
:::note
IO控制器从CPU接收一个读命令，然后从外部读数据。一旦数据读入了IO控制器的数据寄存器，这时IO控制器向CPU发出中断信号，CPU收到中断信号后，发出取数命令，IO控制器将数据通过数据总线传到CPU寄存器当中。
#### 优点
- 数据在设备传输到设备管理器这一段过程，CPU不必循环检测，可以去干别的事，提高了CPU利用率
#### 缺点
- 每次中断后，数据都要经过CPU才能传进主存，这个过程比较费时。
- 一次传输一个字
:::

### DMA控制方式
:::note
DMA(direct memory access)在主存和设备管理器之间开辟一个专有通路，数据可以直接从IO设备传入主存，不需要经过CPU，只有当数据已经进行主存后，DMA控制才向CPU发出中断信号，告诉CPU数据传输完毕  
DMA控制方式中，DMA控制器取代了传统的IO接口（设备控制器），也可以说是evolution版的IO接口。
由于DMA控制方式很少有详细且明确的通路图，这里引用“[micro chip](https://skywalkerch-1303839378.cos.ap-nanjing.myqcloud.com/mypicbed202307111455847.pdf)”的官方文档的解释
![](https://skywalkerch-1303839378.cos.ap-nanjing.myqcloud.com/mypicbed202307111413121.png)

![](https://skywalkerch-1303839378.cos.ap-nanjing.myqcloud.com/mypicbed202307111414360.png)

**DMA数据传输通路**
这个图是按照自己的理解所画，不是权威图，权威图应参考上图。
![](https://skywalkerch-1303839378.cos.ap-nanjing.myqcloud.com/mypicbed202307111447915.svg)
#### 优点
- 数据传输到主存不需要经过CPU，大大提高CPU利用率
- 基本传送单位是数据块（多个字）
- 数据块送入主存后，才向CPU发出中断信号，数据传送过程完全由DMA控制器来完成
#### 缺点
- CPU一开始需要给DMA控制器发送数据存储地址和数据块的大小等数据，在传送前需要CPU干预一下。
- 一个DMA控制器在同一时间段只能对应一台设备与内存进行数据交换
:::

:::warning
一个DMA控制器可以连接多个IO设备，但是每个IO设备需要**一个独立的DMA通道或者DMA控制器**来进行数据传输控制。这是因为DMA控制器的主要作用是协调和管理设备之间的数据传输，如果多个设备共用一个DMA通道或者DMA控制器，就会导致数据传输的冲突和干扰，从而影响系统的稳定性和可靠性。
这个DMA通道就是DMA控制单元与内存直接相连接的通道，同一时间段内只能有一个io设备的数据传输占用这个通道，说简单点就是，资源有限，io设备只能一个一个来。

在实际应用中，一个DMA控制器可以连接多个IO设备的接口，以实现对多个IO设备的数据传输控制。每个IO设备的接口**通常都有一个独立的控制器**，用于控制设备的数据传输和管理设备的缓存。DMA控制器可以通过这些控制器和接口来实现对多个IO设备的数据传输控制，从而提高系统的数据传输效率和性能。

需要注意的是，每个DMA控制器的带宽和传输速度是有限的，因此在同时控制多个设备进行数据传输时，需要合理分配DMA通道的带宽和传输速度，以避免数据传输的冲突和干扰，从而保证数据传输的正确性和可靠性。
:::


### 通道控制方式
:::note
通道控制方式是DMA的进化版，CPU将**一批**要传送数据的程序请求先放入主存中的某个区域，这个程序段称为**“通道程序”**，通道这种控制器读取通道程序来完成一大批数据的传送，传送过程和DMA类似，不经过CPU，当完成通道程序指定的数据传输任务后，才向CPU发出中断信号，告诉CPU数据传输完毕。
通道作为一个集中管理**设备管理器**的**硬件**，其功能与CPU类似，可以看成是侏儒版的CPU，仅用来控制数据传输。

#### 优点

- 和DMA控制方式的优点相同，但没有DMA控制器，取而代之的是通道这种硬件机制。
- 一次可以传输通过程序指定的一大批的数据，这个传输过程不需要CPU干预，大大提高了CPU的利用率。
- 数据的存储地址和数据的大小由通道程序决定，不需要CPU在数据传输前干预
- 一个通道在同一时间段可以对应多台设备与内存数据进行交换


